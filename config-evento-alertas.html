<!DOCTYPE html>
<html lang="pt-br">
<head>
    <title>SPEC - Sistema de Monitoramento ILPI</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Sistema de Monitoramento ILPI" />
    <link href="css/thalamus.css" rel="stylesheet" type="text/css" />
    <style>
        /* Estilos gerais */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        /* Estilos da tabela */
        .tabela {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
            background-color: #fff;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .tabela thead th {
            background-color: #f8f9fa;
            font-weight: 600;
            text-align: left;
            padding: 1rem;
            border-bottom: 2px solid #dee2e6;
        }

        .tabela td {
            vertical-align: middle;
            padding: 0.75rem;
            border-bottom: 1px solid #dee2e6;
        }

        /* Estilos para chips e contadores */
        .chip {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            margin-left: 8px;
            font-weight: 500;
        }

        .bg-ok {
            background-color: #4caf50;
            color: white;
        }

        .bg-cinza {
            background-color: #f0f0f0;
            color: #333;
        }

        .bg-ausente {
            background-color: #ffa726;
            color: white;
        }

        /* Estilos para elementos clicáveis */
        .clicavel {
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .clicavel:hover {
            background-color: #f5f5f5;
        }

        /* Estilos para o menu lateral */
        aside {
            width: 250px;
            background-color: #fff;
            border-right: 1px solid #eee;
            height: 100%;
            position: fixed;
            left: 0;
            top: 60px;
            overflow-y: auto;
            transition: all 0.3s ease;
        }

        .esconde aside {
            width: 60px;
        }

        /* Estilos para paginação */
        .paginacao {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .paginacao a {
            padding: 0.5rem 1rem;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            color: #4a6ee0;
            text-decoration: none;
            transition: all 0.2s;
        }

        .paginacao a.ativo {
            background-color: #4a6ee0;
            color: white;
            border-color: #4a6ee0;
        }

        .paginacao a:hover:not(.ativo) {
            background-color: #f8f9fa;
        }

        /* Estilos para pesquisa */
        .pesquisa {
            display: flex;
            align-items: center;
            background-color: #f8f9fa;
            border-radius: 4px;
            padding: 0.5rem;
        }

        .pesquisa input {
            border: none;
            background: none;
            padding: 0.5rem;
            width: 200px;
            outline: none;
        }

        /* Estilos para ícones */
        .icone-pesquisa {
            width: 24px;
            height: 24px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%234a6ee0"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>');
            background-repeat: no-repeat;
            background-position: center;
        }

        .icone-adicionar-header {
            display: inline-block;
            width: 32px;
            height: 32px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%234a6ee0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>');
            background-repeat: no-repeat;
            background-position: center;
            background-size: 24px 24px;
            cursor: pointer;
            border: none;
            outline: none;
            transition: background-color 0.3s ease;
        }

        .icone-adicionar-header:hover {
            background-color: #f0f5ff;
            border-radius: 4px;
        }

        /* Estilos para status */
        .status-ativo {
            background-color: #4caf50;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .status-inativo {
            background-color: #f44336;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        /* Estilos para formulário */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .btn-primario {
            background-color: #4a6ee0;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
        }

        .btn-secundario {
            background-color: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            margin-right: 0.5rem;
        }

        /* Estilos para ícones de ação */
        .acoes {
            white-space: nowrap;
            text-align: center;
            min-width: 80px;
            padding: 0 10px;
        }

        .icone-salvar,
        .icone-excluir,
        .icone-adicionar {
            display: inline-block;
            margin: 0 5px;
            font-size: 18px;
            text-decoration: none;
            vertical-align: middle;
        }

        .acoes a:first-child {
            margin-left: 8px;
        }

        .acoes a:last-child {
            margin-right: 8px;
        }

        .icone-salvar:hover,
        .icone-adicionar:hover {
            color: #4a6ee0;
            transform: scale(1.2);
            transition: transform 0.2s;
        }

        .icone-excluir:hover {
            color: #f44336;
            transform: scale(1.2);
            transition: transform 0.2s;
        }

        /* Estilos para tags de classe de hóspede */
        .tag-classe {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .tag-cadeirante {
            background-color: #2196f3;
            color: white;
        }

        .tag-acamado {
            background-color: #9c27b0;
            color: white;
        }

        .tag-andador {
            background-color: #00bcd4;
            color: white;
        }

        .tag-bengala {
            background-color: #009688;
            color: white;
        }

        .tag-independente {
            background-color: #8bc34a;
            color: white;
        }

        /* Correção para o problema de posicionamento e rolagem na modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none; /* Inicialmente escondida */
            justify-content: center;
            align-items: flex-start; /* Alinha ao topo em vez de ao centro */
            z-index: 1000;
            overflow-y: auto; /* Permite rolagem na overlay */
            padding: 2rem 0; /* Adiciona espaço acima e abaixo */
        }

        .modal {
            position: relative;
            width: 80%;
            max-width: 800px;
            margin: 2rem 0; /* Adiciona margem acima e abaixo */
        }

        .modal-mask {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            width: 100%;
            overflow-y: visible; /* Permite que o conteúdo flua naturalmente */
            display: block;
        }

        .jm {
            padding: 2rem;
            box-sizing: border-box;
        }

        /* Ajuste para garantir que os botões de ação sejam visíveis */
        .modal-footer {
            margin-top: 1rem;
            display: flex;
            justify-content: flex-end;
            padding: 1rem 0;
            border-top: 1px solid #f0f0f0;
        }

        /* Z-index para modais */
        #modalNovoAlerta {
            z-index: 1000;
        }

        #modalEditarAlerta {
            z-index: 1000;
        }

        /* Estilos específicos para alertas */
        .destinatario-container {
            margin-top: 0.5rem;
        }

        .destinatario-container input {
            margin-top: 0.5rem;
        }

        .alerta-evento {
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Estilos para seleção múltipla de eventos */
        .eventos-container {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 10px;
        }

        .evento-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            padding: 5px;
            border-radius: 4px;
        }

        .evento-item:hover {
            background-color: #f5f5f5;
        }

        .evento-item input[type="checkbox"] {
            margin-right: 10px;
            width: auto;
        }

        .evento-item label {
            margin: 0;
            flex-grow: 1;
            cursor: pointer;
        }

        .eventos-selecionados {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }

        .evento-tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            background-color: #e0e0e0;
            color: #333;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        .evento-tag-remover {
            margin-left: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .evento-tag-remover:hover {
            color: #f44336;
        }

        @media (max-width: 768px) {
            .alerta-evento {
                max-width: 150px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="linha">
            <div class="coluna">
                <nav class="jm jm-menu nav-maior none" id="menu">
                    <div class="separador">
                        <a href="configuracoes.html">Configurações</a>
                        <a href="hospedes.html">Gestão de Hóspedes</a>
                        <a href="monitoramento.html" class="ativo">Monitoramento</a>
                        <a href="#">Sair</a>
                    </div>
                </nav>
                <a href="inicial.html" class="logo logo-menor">Thalamus</a>
                <a href="#" class="icone-avancar negrito com-texto" onclick="document.getElementById('menu').classList.toggle('none');this.classList.toggle('ativo');return false">Monitoramento</a>
            </div>
         
        </div>
    </header>

    <main id="main">
        <aside>
            <div class="titulo margem efeito">
                <div class="m-icone"><a href="#" class="icone-menu" title="Menu" onclick="document.getElementById('main').classList.toggle('esconde');return false"></a></div>
            </div>
            <div class="separador margem">
                <div class="m-icone">
                    <a href="javascript:abaMenu('Monitoramento')" class="icone-compras ativo" title="Monitoramento" id="Monitoramento"></a>
                    <a href="javascript:abaMenu('Configuracoes')" class="icone-gestao" title="Configurações" id="Configuracoes"></a>
                    <a href="javascript:abaMenu('Relatorios')" class="icone-alvo" title="Relatórios" id="Relatorios"></a>
                </div>
            </div>
            <nav id="menuMonitoramento" class="nav-maior separador">
                <a href="painel.html" class="ativo">Monitoramento e alerta</a>
            </nav>
            <nav id="menuConfiguracoes" class="nav-maior separador none">
                <a href="hospede.html">Hóspede</a>
                <a href="cameraQuarto.html">Câmeras e Quartos</a>
                <a href="quartoHospede.html">Hospede Quarto</a>
                <a href="tipo-eventos.html">Tipo dte evento</a>
                <a href="tipo-alerta.html">Tipo de Alertas</a>
                <a href="config-evento-alertas.html" class="ativo">Configurações de eventos/alertas</a>
                <a href="classeHospede.html">Classe de hóspede</a>
                <a href="condicoesSaude.html">Condições de saúde</a>
            </nav>
            <nav id="menuRelatorios" class="nav-maior separador none">
                <a href="relatorio-eventos.html">Relatório de Eventos</a>
                <a href="relatorio-alertas.html">Relatório de Alertas</a>
                <a href="estatisticas.html">Estatísticas</a>
            </nav>
        </aside>
        <section>
            <div class="titulo">
                <div class="margem container">
                    <div class="m-icone direita">
                        <div class="pesquisa">
                            <input type="text" placeholder="Pesquise aqui" id="searchInput" onkeyup="pesquisarAlertas()" />
                           
                        </div>
                        <a href="#" class="icone-adicionar-header" title="Adicionar Alerta" onclick="abrirModalNovoAlerta()"></a>
                    </div>
                    <h2>Configuração de Alertas</h2>
                </div>
            </div>
            <div class="margem container">
                <div class="bloco margem">
                    <table class="tabela">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Classe de Hóspede</th>
                                <th>Eventos Monitorados</th>
                                <th>Tipos de Alerta</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaAlertas">
                            <!-- Dados serão inseridos via JavaScript -->
                        </tbody>
                    </table>
                    <div class="paginacao">
                        <a href="#" class="ativo">1</a>
                        <a href="#">2</a>
                        <a href="#">3</a>
                        <span>...</span>
                        <a href="#">5</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Modal para Adicionar Novo Alerta -->t
        <div class="modal-overlay" id="modalNovoAlerta">
            <div class="modal">
                <div class="modal-mask">
                    <div class="jm">
                        <div class="modal-header">
                            <h3>Adicionar Novo Alerta</h3>
                        </div>
                        <form id="formNovoAlerta">
                            <div class="form-group">
                                <label for="novoClasseHospede">Classe de Hóspede*</label>
                                <select id="novoClasseHospede" required>
                                    <option value="">Selecione</option>
                                    <option value="cadeirante">Cadeirante</option>
                                    <option value="acamado">Acamado</option>
                                    <option value="andador">Usuário de Andador</option>
                                    <option value="bengala">Usuário de Bengala</option>
                                    <option value="independente">Independente</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Eventos Monitorados*</label>
                                <div class="eventos-container" id="novoEventosContainer">
                                    <!-- Checkboxes serão inseridos via JavaScript -->
                                </div>
                                <div class="eventos-selecionados" id="novoEventosSelecionados">
                                    <!-- Tags de eventos selecionados serão inseridos via JavaScript -->
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Tipos de Alerta*</label>
                                <div id="novoTiposAlertasContainer">
                                    <div class="tipo-alerta">
                                        <select class="novoTipoAlerta" required>
                                            <option value="">Selecione</option>
                                            <option value="whatsapp">WhatsApp</option>
                                            <option value="email">Email</option>
                                            <option value="email">Sirene</option>
                                            <option value="app">App</option>
                                            <option value="tela">Tela de Monitoramento</option>
                                        </select>
                                        <input type="text" class="novoDestinatario" placeholder="Destinatário" required />
                                        <button type="button" class="btn-secundario" onclick="removerTipoAlerta(this)">Remover</button>
                                    </div>
                                </div>
                                <button type="button" class="btn-primario" onclick="adicionarTipoAlerta()">Adicionar Tipo de Alerta</button>
                            </div>

                            <div class="modal-footer">
                                <button type="button" class="btn-secundario" onclick="fecharModalNovoAlerta()">Cancelar</button>
                                <button type="button" class="btn-primario" onclick="salvarNovoAlerta()">Salvar</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal para Editar Alerta -->
        <div class="modal-overlay" id="modalEditarAlerta">
            <div class="modal">
                <div class="modal-mask">
                    <div class="jm">
                        <div class="modal-header">
                            <h3>Editar Alerta</h3>
                        </div>
                        <form id="formEditarAlerta">
                            <input type="hidden" id="editarAlertaId" />

                            <div class="form-group">
                                <label for="editarClasseHospede">Classe de Hóspede*</label>
                                <select id="editarClasseHospede" required>
                                    <option value="cadeirante">Cadeirante</option>
                                    <option value="acamado">Acamado</option>
                                    <option value="andador">Usuário de Andador</option>
                                    <option value="bengala">Usuário de Bengala</option>
                                    <option value="independente">Independente</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Eventos Monitorados*</label>
                                <div class="eventos-container" id="editarEventosContainer">
                                    <!-- Checkboxes serão inseridos via JavaScript -->
                                </div>
                                <div class="eventos-selecionados" id="editarEventosSelecionados">
                                    <!-- Tags de eventos selecionados serão inseridos via JavaScript -->
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Tipos de Alerta*</label>
                                <div id="editarTiposAlertasContainer">
                                    <div class="tipo-alerta">
                                        <select class="editarTipoAlerta" required>
                                            <option value="whatsapp">WhatsApp</option>
                                            <option value="whatsapp">Sirene</option>
                                            <option value="email">Email</option>
                                            <option value="app">App</option>
                                            <option value="tela">Tela de Monitoramento</option>
                                        </select>
                                        <input type="text" class="editarDestinatario" placeholder="Destinatário" required />
                                        <button type="button" class="btn-secundario" onclick="removerTipoAlerta(this)">Remover</button>
                                    </div>
                                </div>
                                <button type="button" class="btn-primario" onclick="adicionarTipoAlerta('editar')">Adicionar Tipo de Alerta</button>
                            </div>

                            <div class="modal-footer">
                                <button type="button" class="btn-secundario" onclick="fecharModalEditarAlerta()">Cancelar</button>
                                <button type="button" class="btn-primario" onclick="salvarAlertaEditado()">Salvar</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Lista de eventos disponíveis para monitoramento
        const eventosDisponiveis = [
            { id: 'pessoa_pe', nome: 'Pessoa de Pé' },
            { id: 'tentando_levantar', nome: 'Tentando Levantar' },
            { id: 'agitacao', nome: 'Agitação' },
            { id: 'taxa_movimentacao', nome: 'Taxa Movimentação > 30%' },
            { id: 'deitando', nome: 'Deitando' },
            { id: 'saindo_quarto', nome: 'Saindo do Quarto' },
            { id: 'queda', nome: 'Queda Detectada' },
            { id: 'ausencia_prolongada', nome: 'Ausência Prolongada' },
            { id: 'comportamento_incomum', nome: 'Comportamento Incomum' }
        ];

        // Dados dos alertas (simulando um banco de dados)
        let alertas = [
            {
                id: "AL001",
                eventos: ['pessoa_pe', 'tentando_levantar'],
                classeHospede: "cadeirante",
                tiposAlertas: [
                    { tipo: "whatsapp", destinatario: "+5511987654321" },
                    { tipo: "tela", destinatario: "central_monitoramento" }
                ],
                status: "ativo"
            },
            {
                id: "AL002",
                eventos: ['ausencia_prolongada', 'saindo_quarto'],
                classeHospede: "andador",
                tiposAlertas: [
                    { tipo: "email", destinatario: "enfermagem@ilpi.com.br" },
                    { tipo: "tela", destinatario: "central_monitoramento" }
                ],
                status: "ativo"
            },
            {
                id: "AL003",
                eventos: ['agitacao', 'comportamento_incomum'],
                classeHospede: "acamado",
                tiposAlertas: [
                    { tipo: "app", destinatario: "supervisor_enfermagem" }
                ],
                status: "ativo"
            },
            {
                id: "AL004",
                eventos: ['queda', 'taxa_movimentacao'],
                classeHospede: "bengala",
                tiposAlertas: [
                    { tipo: "tela", destinatario: "central_monitoramento" }
                ],
                status: "ativo"
            },
            {
                id: "AL005",
                eventos: ['deitando'],
                classeHospede: "independente",
                tiposAlertas: [
                    { tipo: "whatsapp", destinatario: "+5511912345678" }
                ],
                status: "inativo"
            }
        ];

        // Função para controlar o menu lateral
        function abaMenu(aba) {
            // Primeiro, remova todas as classes ativas dos ícones
            document.getElementById('Monitoramento').classList.remove('ativo');
            document.getElementById('Configuracoes').classList.remove('ativo');
            document.getElementById('Relatorios').classList.remove('ativo');

            // Em seguida, esconda todos os menus
            document.getElementById('menuMonitoramento').classList.add('none');
            document.getElementById('menuConfiguracoes').classList.add('none');
            document.getElementById('menuRelatorios').classList.add('none');

            // Por fim, ative o ícone e mostre o menu correspondente
            document.getElementById(aba).classList.add('ativo');
            document.getElementById('menu' + aba).classList.remove('none');

            // Salvar o estado do menu no localStorage
            localStorage.setItem('menuAtivo', aba);
        }

        // Função para renderizar a tabela de alertas
        function renderizarTabela() {
            const tbody = document.getElementById('tabelaAlertas');

            // Limpar tabela
            tbody.innerHTML = '';

            // Adicionar cada alerta à tabela
            alertas.forEach(alerta => {
                const tr = document.createElement('tr');

                // Criar HTML para os eventos monitorados
                let eventosHTML = '';
                alerta.eventos.forEach(eventoId => {
                    const evento = eventosDisponiveis.find(e => e.id === eventoId);
                    if (evento) {
                        eventosHTML += `<span class="evento-tag">${evento.nome}</span>`;
                    }
                });

                // Criar HTML para os tipos de alerta
                let tiposAlertasHTML = '';
                alerta.tiposAlertas.forEach(tipoAlerta => {
                    tiposAlertasHTML += `<span class="tag-alerta tag-${tipoAlerta.tipo}">${getTipoAlertaTexto(tipoAlerta.tipo)}: ${tipoAlerta.destinatario}</span></br>`;
                });

                tr.innerHTML = `
                    <td>${alerta.id}</td>
                    <td><span class="tag-classe tag-${alerta.classeHospede}">${getClasseHospedeTexto(alerta.classeHospede)}</span></td>
                    <td>${eventosHTML}</td>
                    <td>${tiposAlertasHTML}</td>
                    <td><span class="status-${alerta.status}">${alerta.status === 'ativo' ? 'Ativo' : 'Inativo'}</span></td>
                    <td class="acoes">
                        <a href="javascript:void(0)" class="icone-salvar" onclick="editarAlerta('${alerta.id}')">✏️</a>
                        <a href="javascript:void(0)" class="icone-excluir" onclick="excluirAlerta('${alerta.id}')">🗑️</a>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Funções auxiliares para obter texto formatado
        function getTipoAlertaTexto(tipo) {
            const tipos = {
                'whatsapp': 'WhatsApp',
                'email': 'Email',
                'app': 'App',
                'tela': 'Tela'
            };
            return tipos[tipo] || tipo;
        }

        function getClasseHospedeTexto(classe) {
            const classes = {
                'cadeirante': 'Cadeirante',
                'acamado': 'Acamado',
                'andador': 'Usuário de Andador',
                'bengala': 'Usuário de Bengala',
                'independente': 'Independente'
            };
            return classes[classe] || classe;
        }

        // Função para abrir modal de novo alerta
        function abrirModalNovoAlerta() {
            // Limpar formulário
            document.getElementById('formNovoAlerta').reset();

            // Exibir modal
            document.getElementById('modalNovoAlerta').style.display = 'flex';

            // Renderizar checkboxes de eventos
            renderizarCheckboxesEventos('novoEventosContainer');
        }

        // Função para fechar modal de novo alerta
        function fecharModalNovoAlerta() {
            document.getElementById('modalNovoAlerta').style.display = 'none';
        }

        // Função para salvar novo alerta
        function salvarNovoAlerta() {
            const classeHospede = document.getElementById('novoClasseHospede').value;
            const eventos = getEventosSelecionados('novoEventosContainer');
            const tiposAlertas = [];

            // Coletar tipos de alerta e destinatários
            const tipoAlertasElements = document.querySelectorAll('#novoTiposAlertasContainer .tipo-alerta');
            tipoAlertasElements.forEach(element => {
                const tipo = element.querySelector('.novoTipoAlerta').value;
                const destinatario = element.querySelector('.novoDestinatario').value;
                if (tipo && destinatario) {
                    tiposAlertas.push({ tipo, destinatario });
                }
            });

            // Validar campos obrigatórios
            if (!classeHospede || eventos.length === 0 || tiposAlertas.length === 0) {
                alert('Por favor, preencha todos os campos obrigatórios e selecione pelo menos um evento e um tipo de alerta!');
                return;
            }

            // Gerar ID único para o novo alerta (formato: AL + número sequencial)
            const novoId = gerarNovoId();

            // Criar novo alerta
            const novoAlerta = {
                id: novoId,
                eventos,
                classeHospede,
                tiposAlertas,
                status: "ativo" // Status padrão ao criar
            };

            // Adicionar à lista de alertas
            alertas.push(novoAlerta);

            // Atualizar tabela
            renderizarTabela();

            // Fechar modal
            fecharModalNovoAlerta();

            alert(`Alerta "${novoId}" adicionado com sucesso!`);
        }

        // Função para gerar novo ID
        function gerarNovoId() {
            // Encontrar o maior número de ID atual
            let maxNum = 0;
            alertas.forEach(alerta => {
                const num = parseInt(alerta.id.replace('AL', ''));
                if (num > maxNum) {
                    maxNum = num;
                }
            });

            // Gerar próximo número e formatar com zeros à esquerda
            const nextNum = maxNum + 1;
            return `AL${nextNum.toString().padStart(3, '0')}`;
        }

        // Função para editar alerta
        function editarAlerta(id) {
            const alerta = alertas.find(a => a.id === id);
            if (!alerta) return;

            // Preencher formulário
            document.getElementById('editarAlertaId').value = alerta.id;
            document.getElementById('editarClasseHospede').value = alerta.classeHospede;

            // Renderizar checkboxes de eventos
            renderizarCheckboxesEventos('editarEventosContainer', alerta.eventos);

            // Limpar e preencher tipos de alerta
            const tiposAlertasContainer = document.getElementById('editarTiposAlertasContainer');
            tiposAlertasContainer.innerHTML = '';
            alerta.tiposAlertas.forEach(tipoAlerta => {
                const div = document.createElement('div');
                div.className = 'tipo-alerta';
                div.innerHTML = `
                    <select class="editarTipoAlerta" required>
                        <option value="whatsapp" ${tipoAlerta.tipo === 'whatsapp' ? 'selected' : ''}>WhatsApp</option>
                        <option value="email" ${tipoAlerta.tipo === 'email' ? 'selected' : ''}>Email</option>
                           <option value="email" ${tipoAlerta.tipo === 'sirene' ? 'selected' : ''}>sirena</option>
                        <option value="app" ${tipoAlerta.tipo === 'app' ? 'selected' : ''}>App</option>
                        <option value="tela" ${tipoAlerta.tipo === 'tela' ? 'selected' : ''}>Tela de Monitoramento</option>
                    </select>
                    <input type="text" class="editarDestinatario" placeholder="Destinatário" value="${tipoAlerta.destinatario}" required />
                    <button type="button" class="btn-secundario" onclick="removerTipoAlerta(this)">Remover</button>
                `;
                tiposAlertasContainer.appendChild(div);
            });

            // Exibir modal
            document.getElementById('modalEditarAlerta').style.display = 'flex';
        }

        // Função para fechar modal de edição
        function fecharModalEditarAlerta() {
            document.getElementById('modalEditarAlerta').style.display = 'none';
        }

        // Função para salvar alerta editado
        function salvarAlertaEditado() {
             const id = document.getElementById('editarAlertaId').value;
             const classeHospede = document.getElementById('editarClasseHospede').value;
             const eventos = getEventosSelecionados('editarEventosContainer');
             const tiposAlertas = [];
            
            // Coletar tipos de alerta e destinatários
            const tipoAlertasElements = document.querySelectorAll('#editarTiposAlertasContainer .tipo-alerta');
            tipoAlertasElements.forEach(element => {
                const tipoElement = element.querySelector('.editarTipoAlerta');
                const destinatarioElement = element.querySelector('.editarDestinatario');

                // Verifique se os elementos foram encontrados antes de acessar suas propriedades
                if (tipoElement && destinatarioElement) {
                    const tipo = tipoElement.value;
                    const destinatario = destinatarioElement.value;

                    if (tipo && destinatario) {
                        tiposAlertas.push({ tipo, destinatario });
                    }
                }
            });

            // Validar campos obrigatórios
            if (!classeHospede || eventos.length === 0 || tiposAlertas.length === 0) {
                alert('Por favor, preencha todos os campos obrigatórios e selecione pelo menos um evento e um tipo de alerta!');
                return;
            }

            // Atualizar alerta
            const index = alertas.findIndex(a => a.id === id);
            if (index !== -1) {
                alertas[index] = {
                    id,
                    eventos,
                    classeHospede,
                    tiposAlertas,
                    status: alertas[index].status // Manter o status atual
                };
            }

            // Atualizar tabela
            renderizarTabela();

            // Fechar modal
            fecharModalEditarAlerta();

            alert(`Alerta "${id}" atualizado com sucesso!`);
        }

        // Função para excluir alerta
        function excluirAlerta(id) {
            if (confirm('Deseja realmente excluir este alerta?')) {
                alertas = alertas.filter(a => a.id !== id);
                renderizarTabela();
                alert('Alerta excluído com sucesso!');
            }
        }

        // Função para renderizar checkboxes de eventos
        function renderizarCheckboxesEventos(containerId, eventosSelecionados = []) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            eventosDisponiveis.forEach(evento => {
                const checked = eventosSelecionados.includes(evento.id) ? 'checked' : '';
                const div = document.createElement('div');
                div.className = 'evento-item';
                div.innerHTML = `
                    <input type="checkbox" id="${containerId}_${evento.id}" value="${evento.id}" ${checked}>
                    <label for="${containerId}_${evento.id}">${evento.nome}</label>
                `;
                container.appendChild(div);
            });
        }

        // Função para obter os eventos selecionados
        function getEventosSelecionados(containerId) {
            const checkboxes = document.querySelectorAll(`#${containerId} input[type="checkbox"]:checked`);
            return Array.from(checkboxes).map(checkbox => checkbox.value);
        }

        // Função para adicionar um novo tipo de alerta
        function adicionarTipoAlerta(prefixo = 'novo') {
            const container = document.getElementById(prefixo + 'TiposAlertasContainer');
            const div = document.createElement('div');
            div.className = 'tipo-alerta';
            div.innerHTML = `
                <select class="novoTipoAlerta" required>
                    <option value="">Selecione</option>
                    <option value="whatsapp">WhatsApp</option>
                    <option value="email">Email</option>
                    <option value="app">App</option>
                    <option value="tela">Tela de Monitoramento</option>
                </select>
                <input type="text" class="novoDestinatario" placeholder="Destinatário" required />
                <button type="button" class="btn-secundario" onclick="removerTipoAlerta(this)">Remover</button>
            `;
            container.appendChild(div);
        }

        // Função para remover um tipo de alerta
        function removerTipoAlerta(button) {
            const tipoAlertaDiv = button.parentElement;
            tipoAlertaDiv.remove();
        }

        // Inicializar a página
        document.addEventListener('DOMContentLoaded', function() {
            renderizarTabela();

            // Recuperar o estado do menu do localStorage
            const menuAtivo = localStorage.getItem('menuAtivo') || 'Configuracoes';

            // Aplicar o estado do menu
            document.getElementById('Monitoramento').classList.remove('ativo');
            document.getElementById('Configuracoes').classList.remove('ativo');
            document.getElementById('Relatorios').classList.remove('ativo');

            document.getElementById('menuMonitoramento').classList.add('none');
            document.getElementById('menuConfiguracoes').classList.add('none');
            document.getElementById('menuRelatorios').classList.add('none');

            document.getElementById(menuAtivo).classList.add('ativo');
            document.getElementById('menu' + menuAtivo).classList.remove('none');

            // Adicionar eventos para fechar modais ao clicar fora
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.style.display = 'none';
                    }
                });
            });
        });

        // Verificar se a página foi carregada completamente
        window.onload = function() {
            const tbody = document.getElementById('tabelaAlertas');
            if (tbody && !tbody.innerHTML.trim()) {
                renderizarTabela();
            }
        };
    </script>
</body>
</html>