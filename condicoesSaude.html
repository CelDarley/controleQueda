<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <title>SPEC - Sistema de Monitoramento ILPI</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <meta name="description" content="Sistema de Monitoramento ILPI"/>
        <link href="css/thalamus.css" rel="stylesheet" type="text/css"/>
        <style>
            /* Estilos gerais */
            body {
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 0;
            }

            /* Estilos da tabela */
            .tabela {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 1rem;
                background-color: #fff;
                box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            }

            .tabela thead th {
                background-color: #f8f9fa;
                font-weight: 600;
                text-align: left;
                padding: 1rem;
                border-bottom: 2px solid #dee2e6;
            }

            .tabela td {
                vertical-align: middle;
                padding: 0.75rem;
                border-bottom: 1px solid #dee2e6;
            }

            /* Estilos para chips e contadores */
            .chip {
                display: inline-block;
                padding: 2px 8px;
                border-radius: 12px;
                font-size: 0.75rem;
                margin-left: 8px;
                font-weight: 500;
            }

            .bg-ok {
                background-color: #4CAF50;
                color: white;
            }

            .bg-cinza {
                background-color: #f0f0f0;
                color: #333;
            }

            .bg-ausente {
                background-color: #FFA726;
                color: white;
            }

            /* Estilos para elementos clicáveis */
            .clicavel {
                cursor: pointer;
                transition: background-color 0.2s;
            }

            .clicavel:hover {
                background-color: #f5f5f5;
            }

            /* Estilos para o menu lateral */
            aside {
                width: 250px;
                background-color: #fff;
                border-right: 1px solid #eee;
                height: 100%;
                position: fixed;
                left: 0;
                top: 60px;
                overflow-y: auto;
                transition: all 0.3s ease;
            }

            .esconde aside {
                width: 60px;
            }

            /* Estilos para paginação */
            .paginacao {
                display: flex;
                justify-content: center;
                gap: 0.5rem;
                margin-top: 1rem;
            }

            .paginacao a {
                padding: 0.5rem 1rem;
                border: 1px solid #dee2e6;
                border-radius: 4px;
                color: #4a6ee0;
                text-decoration: none;
                transition: all 0.2s;
            }

            .paginacao a.ativo {
                background-color: #4a6ee0;
                color: white;
                border-color: #4a6ee0;
            }

            .paginacao a:hover:not(.ativo) {
                background-color: #f8f9fa;
            }

            /* Estilos para pesquisa */
            .pesquisa {
                display: flex;
                align-items: center;
                background-color: #f8f9fa;
                border-radius: 4px;
                padding: 0.5rem;
            }

            .pesquisa input {
                border: none;
                background: none;
                padding: 0.5rem;
                width: 200px;
                outline: none;
            }

            /* Estilos para ícones */
            .icone-pesquisa {
                width: 24px;
                height: 24px;
                background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%234a6ee0"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>');
                background-repeat: no-repeat;
                background-position: center;
            }

            .icone-adicionar-header {
                display: inline-block;
                width: 32px;
                height: 32px;
                background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%234a6ee0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>');
                background-repeat: no-repeat;
                background-position: center;
                background-size: 24px 24px;
                cursor: pointer;
                border: none;
                outline: none;
                transition: background-color 0.3s ease;
            }

            .icone-adicionar-header:hover {
                background-color: #f0f5ff;
                border-radius: 4px;
            }
            
            /* Estilos para status */
            .status-ativo {
                background-color: #4CAF50;
                color: white;
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 0.8rem;
            }
            
            .status-inativo {
                background-color: #F44336;
                color: white;
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 0.8rem;
            }
            
            /* Estilos para formulário */
            .form-group {
                margin-bottom: 1rem;
            }
            
            .form-group label {
                display: block;
                margin-bottom: 0.5rem;
                font-weight: 500;
            }
            
            .form-group input,
            .form-group select,
            .form-group textarea {
                width: 100%;
                padding: 0.5rem;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-size: 1rem;
            }
            
            .grid-2 {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1rem;
            }
            
            .btn-primario {
                background-color: #4a6ee0;
                color: white;
                border: none;
                padding: 0.5rem 1rem;
                border-radius: 4px;
                cursor: pointer;
                font-size: 1rem;
            }
            
            .btn-secundario {
                background-color: #f8f9fa;
                color: #333;
                border: 1px solid #ddd;
                padding: 0.5rem 1rem;
                border-radius: 4px;
                cursor: pointer;
                font-size: 1rem;
                margin-right: 0.5rem;
            }
            
            /* Estilos para ícones de ação */
            .acoes {
                white-space: nowrap;
                text-align: center;
                min-width: 80px;
                padding: 0 10px;
            }

            .icone-salvar,
            .icone-excluir,
            .icone-adicionar {
                display: inline-block;
                margin: 0 5px;
                font-size: 18px;
                text-decoration: none;
                vertical-align: middle;
            }

            .acoes a:first-child {
                margin-left: 8px;
            }

            .acoes a:last-child {
                margin-right: 8px;
            }

            .icone-salvar:hover,
            .icone-adicionar:hover {
                color: #4a6ee0;
                transform: scale(1.2);
                transition: transform 0.2s;
            }

            .icone-excluir:hover {
                color: #F44336;
                transform: scale(1.2);
                transition: transform 0.2s;
            }
            
            /* Correção para o problema de posicionamento e rolagem na modal */
            .modal-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                display: none; /* Inicialmente escondida */
                justify-content: center;
                align-items: flex-start; /* Alinha ao topo em vez de ao centro */
                z-index: 1000;
                overflow-y: auto; /* Permite rolagem na overlay */
                padding: 2rem 0; /* Adiciona espaço acima e abaixo */
            }

            .modal {
                position: relative;
                width: 80%;
                max-width: 800px;
                margin: 2rem 0; /* Adiciona margem acima e abaixo */
            }

            .modal-mask {
                background-color: white;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                width: 100%;
                overflow-y: visible; /* Permite que o conteúdo flua naturalmente */
                display: block;
            }

            .jm {
                padding: 2rem;
                box-sizing: border-box;
            }

            /* Ajuste para garantir que os botões de ação sejam visíveis */
            .modal-footer {
                margin-top: 1rem;
                display: flex;
                justify-content: flex-end;
                padding: 1rem 0;
                border-top: 1px solid #f0f0f0;
            }
            
            /* Z-index para modais */
            #modalNovaCondicao {
                z-index: 1000;
            }
            
            #modalEditarCondicao {
                z-index: 1000;
            }
            
            /* Estilos para categorias de condições de saúde */
            .categoria-titulo {
                font-weight: 600;
                margin-top: 1rem;
                margin-bottom: 0.5rem;
                color: #333;
                border-bottom: 1px solid #eee;
                padding-bottom: 0.5rem;
            }
            
            .condicoes-container {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
                margin-bottom: 1rem;
            }
            
            .checkbox-container {
                display: flex;
                align-items: center;
                margin-bottom: 0.5rem;
            }
            
            .checkbox-container input[type="checkbox"] {
                width: auto;
                margin-right: 10px;
            }
            
            .checkbox-container label {
                margin-bottom: 0;
                font-weight: normal;
            }
            
            /* Estilos para tags de condições de saúde */
            .tag-condicao {
                display: inline-block;
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 0.8rem;
                margin-right: 5px;
                margin-bottom: 5px;
                white-space: nowrap;
            }
            
            .tag-mobilidade {
                background-color: #2196F3;
                color: white;
            }
            
            .tag-risco {
                background-color: #FF9800;
                color: white;
            }
            
            .tag-dependencia {
                background-color: #9C27B0;
                color: white;
            }
            
            .tag-neurologica {
                background-color: #E91E63;
                color: white;
            }
            
            .tag-cronica {
                background-color: #795548;
                color: white;
            }
            
            .tag-sensorial {
                background-color: #009688;
                color: white;
            }
            
            /* Estilos para o container de condições na tabela */
            .condicoes-lista {
                max-width: 400px;
                display: flex;
                flex-wrap: wrap;
                gap: 5px;
            }
            
            /* Estilos para o botão de associar hóspede */
            .btn-associar {
                background-color: #4a6ee0;
                color: white;
                border: none;
                padding: 0.25rem 0.5rem;
                border-radius: 4px;
                cursor: pointer;
                font-size: 0.8rem;
                margin-left: 0.5rem;
            }
            
            .btn-associar:hover {
                background-color: #3a5bbf;
            }
            
            /* Estilos para o seletor de hóspedes */
            .hospede-selector {
                margin-top: 1rem;
                padding: 1rem;
                border: 1px solid #eee;
                border-radius: 4px;
                background-color: #f9f9f9;
            }
        </style>
    </head>
    <body>
        <header>
            <div class="linha">
                <div class="coluna">
                    <nav class="jm jm-menu nav-maior none" id="menu">
                        <div class="separador">
                            <a href="configuracoes.html">Configurações</a>
                            <a href="hospedes.html">Gestão de Hóspedes</a>
                            <a href="condicoes-saude.html" class="ativo">Condições de Saúde</a>
                            <a href="monitoramento.html">Monitoramento</a>
                            <a href="#">Sair</a>
                        </div>
                    </nav>
                    <a href="inicial.html" class="logo logo-menor">Thalamus</a>
                    <a href="#" class="icone-avancar negrito com-texto" onclick="document.getElementById('menu').classList.toggle('none');this.classList.toggle('ativo');return false">Condições de Saúde</a>
                </div>
          
            </div>
        </header>

        <main id="main">  
            <aside>
                <div class="titulo margem efeito">
                    <div class="m-icone"><a href="#" class="icone-menu" title="Menu" onclick="document.getElementById('main').classList.toggle('esconde');return false"></a></div>
                </div>
                <div class="separador margem">
                    <div class="m-icone">
                        <a href="javascript:abaMenu('Monitoramento')" class="icone-compras" title="Monitoramento" id="Monitoramento"></a>
                        <a href="javascript:abaMenu('Configuracoes')" class="icone-gestao ativo" title="Configurações" id="Configuracoes"></a>
                        <a href="javascript:abaMenu('Relatorios')" class="icone-alvo" title="Relatórios" id="Relatorios"></a>
                    </div>
                </div>
                <nav id="menuMonitoramento" class="nav-maior separador none">
                    <a href="painel.html">Monitoramento e alerta</a>
                </nav>
                <nav id="menuConfiguracoes" class="nav-maior separador">
                    <a href="hospede.html">Hóspede</a>
                    <a href="cameraQuarto.html">Câmeras e Quartos</a>
                    <a href="quartoHospede.html">Hospede Quarto</a>
                    <a href="tipo-eventos.html">Tipo de evento</a>
                    <a href="tipo-alerta.html">Tipo de Alertas</a>
                    <a href="config-evento-alertas.html">Configurações de eventos/alertas</a>
                    <a href="classeHospede.html">Classe de hóspede</a>
                    <a href="condicoesSaude.html">Condições de saúde</a>

                </nav>
                <nav id="menuRelatorios" class="nav-maior separador none">
                    <a href="relatorio-eventos.html">Relatório de Eventos</a>
                    <a href="relatorio-alertas.html">Relatório de Alertas</a>
                    <a href="estatisticas.html">Estatísticas</a>
                </nav>
            </aside>
            <section>
                <div class="titulo">
                    <div class="margem container">
                        <div class="m-icone direita">
                            <div class="pesquisa">
                                <input type="text" placeholder="Pesquise aqui" id="searchInput" onkeyup="pesquisarCondicoes()">
                               
                            </div>
                            <a href="#" class="icone-adicionar-header" title="Adicionar Condição" onclick="abrirModalNovaCondicao()"></a>
                        </div>
                        <h2>Gestão de Condições de Saúde</h2> 
                    </div>
                </div>
                <div class="margem container">
                    <div class="bloco margem">
                        <table class="tabela">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nome</th>
                                    <th>Descrição</th>
                              
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="tabelaCondicoes">
                                <!-- Dados serão inseridos via JavaScript -->
                            </tbody>
                        </table>
                        <div class="paginacao">
                            <a href="#" class="ativo">1</a>
                            <a href="#">2</a>
                            <a href="#">3</a>
                            <span>...</span>
                            <a href="#">5</a>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Modal para Adicionar Nova Condição -->
            <div class="modal-overlay" id="modalNovaCondicao">
                <div class="modal">
                    <div class="modal-mask">
                        <div class="jm">
                            <div class="modal-header">
                                <h3>Adicionar Nova Condição de Saúde</h3>
                            </div>
                            <form id="formNovaCondicao">
                                <div class="form-group">
                                    <label for="novoNome">Nome da Condição*</label>
                                    <input type="text" id="novoNome" required>
                                </div>

                                
                                <div class="form-group">
                                    <label for="novoDescricao">Descrição</label>
                                    <textarea id="novoDescricao" rows="3"></textarea>
                                </div>
                         
                                
                                <div class="modal-footer">
                                    <button type="button" class="btn-secundario" onclick="fecharModalNovaCondicao()">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Modal para Editar Condição -->
            <div class="modal-overlay" id="modalEditarCondicao">
                <div class="modal">
                    <div class="modal-mask">
                        <div class="jm">
                            <div class="modal-header">
                                <h3>Editar Condição de Saúde</h3>
                            </div>
                            <form id="formEditarCondicao">
                                <input type="hidden" id="editarCondicaoId">
                                
                                <div class="form-group">
                                    <label for="editarNome">Nome da Condição*</label>
                                    <input type="text" id="editarNome" required>
                                </div>
                                
                  
                                
                                <div class="form-group">
                                    <label for="editarDescricao">Descrição</label>
                                    <textarea id="editarDescricao" rows="3"></textarea>
                                </div>
                                
                    
                                
                                <div class="modal-footer">
                                    <button type="button" class="btn-secundario" onclick="fecharModalEditarCondicao()">Cancelar</button>
                                    <button type="button" class="btn-primario" onclick="salvarCondicaoEditada()">Salvar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Modal para Associar Hóspede -->
            <div class="modal-overlay" id="modalAssociarHospede">
                <div class="modal">
                    <div class="modal-mask">
                        <div class="jm">
                            <div class="modal-header">
                                <h3>Associar Hóspede à Condição</h3>
                            </div>
                            <form id="formAssociarHospede">
                                <input type="hidden" id="associarCondicaoId">
                        
                                
                                <div class="modal-footer">
                                    <button type="button" class="btn-secundario" onclick="fecharModalAssociarHospede()">Cancelar</button>
                                    <button type="button" class="btn-primario" onclick="salvarAssociacaoHospede()">Associar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <script>
            // Dados dos hóspedes (simulando um banco de dados)
            let hospedes = [
                {
                    id: "H001",
                    nome: "Ana Carolina Silva"
                },
                {
                    id: "H002",
                    nome: "José Roberto Oliveira"
                },
                {
                    id: "H003",
                    nome: "Maria Aparecida Santos"
                },
                {
                    id: "H004",
                    nome: "Antônio Carlos Ferreira"
                },
                {
                    id: "H005",
                    nome: "Lúcia Helena Mendes"
                }
            ];

            // Dados das condições de saúde (simulando um banco de dados)
            let condicoes = [
                {
                    id: "CS001",
                    nome: "Mobilidade reduzida",
                    categoria: "mobilidade",
                    descricao: "Dificuldade de locomoção que requer assistência parcial.",
                    hospedesAssociados: ["H001", "H004"]
                },
                {
                    id: "CS002",
                    nome: "Necessita auxílio para transferência",
                    categoria: "mobilidade",
                    descricao: "Requer ajuda para transferir-se da cama para cadeira ou outros locais.",
                    hospedesAssociados: ["H001"]
                },
                {
                    id: "CS003",
                    nome: "Acamado",
                    categoria: "mobilidade",
                    descricao: "Permanece na cama a maior parte do tempo, com mobilidade extremamente limitada.",
                    hospedesAssociados: ["H003"]
                },
                {
                    id: "CS004",
                    nome: "Mobilidade limitada de membros",
                    categoria: "mobilidade",
                    descricao: "Limitação de movimento em um ou mais membros.",
                    hospedesAssociados: []
                },
                {
                    id: "CS005",
                    nome: "Risco de úlcera de pressão",
                    categoria: "risco",
                    descricao: "Risco de desenvolver lesões na pele devido à pressão prolongada.",
                    hospedesAssociados: ["H003"]
                },
                {
                    id: "CS006",
                    nome: "Usa andador",
                    categoria: "mobilidade",
                    descricao: "Utiliza andador como auxílio para locomoção.",
                    hospedesAssociados: ["H002"]
                },
                {
                    id: "CS007",
                    nome: "Usa bengala",
                    categoria: "mobilidade",
                    descricao: "Utiliza bengala como auxílio para locomoção.",
                    hospedesAssociados: ["H004"]
                },
                {
                    id: "CS008",
                    nome: "Risco de queda",
                    categoria: "risco",
                    descricao: "Apresenta fatores que aumentam o risco de quedas.",
                    hospedesAssociados: ["H001", "H002", "H004"]
                },
                {
                    id: "CS009",
                    nome: "Independente",
                    categoria: "dependencia",
                    descricao: "Capaz de realizar atividades diárias sem assistência.",
                    hospedesAssociados: ["H005"]
                },
                {
                    id: "CS010",
                    nome: "Monitoramento preventivo",
                    categoria: "risco",
                    descricao: "Requer monitoramento regular para prevenção de complicações.",
                    hospedesAssociados: ["H001", "H002", "H003", "H004", "H005"]
                },
                {
                    id: "CS011",
                    nome: "Dependente total",
                    categoria: "dependencia",
                    descricao: "Requer assistência total para atividades diárias.",
                    hospedesAssociados: []
                },
                {
                    id: "CS012",
                    nome: "Demência",
                    categoria: "neurologica",
                    descricao: "Apresenta quadro de demência com comprometimento cognitivo.",
                    hospedesAssociados: []
                },
                {
                    id: "CS013",
                    nome: "Alzheimer",
                    categoria: "neurologica",
                    descricao: "Diagnóstico de doença de Alzheimer.",
                    hospedesAssociados: ["H001"]
                },
                {
                    id: "CS014",
                    nome: "Parkinson",
                    categoria: "neurologica",
                    descricao: "Diagnóstico de doença de Parkinson.",
                    hospedesAssociados: []
                },
                {
                    id: "CS015",
                    nome: "AVC prévio",
                    categoria: "neurologica",
                    descricao: "Histórico de Acidente Vascular Cerebral.",
                    hospedesAssociados: ["H003"]
                },{
                    id: "CS016",
                    nome: "Diabetes",
                    categoria: "cronica",
                    descricao: "Diagnóstico de diabetes que requer monitoramento e controle.",
                    hospedesAssociados: ["H002", "H005"]
                },
                {
                    id: "CS017",
                    nome: "Hipertensão",
                    categoria: "cronica",
                    descricao: "Pressão arterial elevada que requer monitoramento e controle.",
                    hospedesAssociados: ["H001", "H002", "H004"]
                },
                {
                    id: "CS018",
                    nome: "Problemas cardíacos",
                    categoria: "cronica",
                    descricao: "Condições cardíacas que requerem acompanhamento.",
                    hospedesAssociados: ["H004"]
                },
                {
                    id: "CS019",
                    nome: "Problemas respiratórios",
                    categoria: "cronica",
                    descricao: "Condições respiratórias que requerem acompanhamento.",
                    hospedesAssociados: ["H003"]
                },
                {
                    id: "CS020",
                    nome: "Deficiência visual",
                    categoria: "sensorial",
                    descricao: "Comprometimento parcial ou total da visão.",
                    hospedesAssociados: ["H005"]
                },
                {
                    id: "CS021",
                    nome: "Deficiência auditiva",
                    categoria: "sensorial",
                    descricao: "Comprometimento parcial ou total da audição.",
                    hospedesAssociados: ["H002"]
                }
            ];

            // Função para controlar o menu lateral
            function abaMenu(aba) {
                // Primeiro, remova todas as classes ativas dos ícones
                document.getElementById('Monitoramento').classList.remove('ativo');
                document.getElementById('Configuracoes').classList.remove('ativo');
                document.getElementById('Relatorios').classList.remove('ativo');
              
                // Em seguida, esconda todos os menus
                document.getElementById('menuMonitoramento').classList.add('none');
                document.getElementById('menuConfiguracoes').classList.add('none');
                document.getElementById('menuRelatorios').classList.add('none');
              
                // Por fim, ative o ícone e mostre o menu correspondente
                document.getElementById(aba).classList.add('ativo');
                document.getElementById('menu' + aba).classList.remove('none');
              
                // Salvar o estado do menu no localStorage
                localStorage.setItem('menuAtivo', aba);
            }  
                  
            // Função para renderizar a tabela de condições
            function renderizarTabela() {
                console.log("Iniciando renderização da tabela");
                const tbody = document.getElementById('tabelaCondicoes');
                
                if (!tbody) {
                    console.error("Elemento tabelaCondicoes não encontrado!");
                    return;
                }
                
                // Limpar tabela
                tbody.innerHTML = '';
                
                console.log("Renderizando", condicoes.length, "condições");
                
                // Verificar se há condições
                if (condicoes.length === 0) {
                    const tr = document.createElement('tr');
                    tr.innerHTML = '<td colspan="6" style="text-align: center;">Nenhuma condição de saúde cadastrada</td>';
                    tbody.appendChild(tr);
                    return;
                }
                
                // Adicionar cada condição à tabela
                condicoes.forEach(condicao => {
                    const tr = document.createElement('tr');
                    
                    // Criar lista de hóspedes associados
                    let hospedesHTML = '';
                    if (condicao.hospedesAssociados.length > 0) {
                        condicao.hospedesAssociados.forEach(hospedeId => {
                            const hospede = hospedes.find(h => h.id === hospedeId);
                            if (hospede) {
                                hospedesHTML += `<span class="chip bg-cinza">${hospede.nome}</span>`;
                            }
                        });
                    } else {
                        hospedesHTML = '<span class="fonte-menor">Nenhum hóspede associado</span>';
                    }
                    
                    tr.innerHTML = `
                        <td>${condicao.id}</td>
                        <td>${condicao.nome}</td>
               
                        <td>${condicao.descricao || '-'}</td>
         
                        <td class="acoes">
                            <a href="javascript:void(0)" class="icone-salvar" onclick="editarCondicao('${condicao.id}')">✏️</a>
                            <a href="javascript:void(0)" class="icone-excluir" onclick="excluirCondicao('${condicao.id}')">🗑️</a>

                        </td>
                    `;
                    tbody.appendChild(tr);
                });

                console.log("Tabela renderizada com sucesso");
            }

            // Funções auxiliares para obter texto formatado
            function getCategoriaTexto(categoria) {
                const categorias = {
                    'mobilidade': 'Mobilidade',
                    'risco': 'Risco',
                    'dependencia': 'Dependência',
                    'neurologica': 'Neurológica',
                    'cronica': 'Crônica',
                    'sensorial': 'Sensorial'
                };
                return categorias[categoria] || categoria;
            }

            // Função para preencher o select de hóspedes
            function preencherSelectHospedes(selectId, hospedesSelecionados = []) {
                const select = document.getElementById(selectId);
                select.innerHTML = '';
                
                hospedes.forEach(hospede => {
                    const option = document.createElement('option');
                    option.value = hospede.id;
                    option.text = `${hospede.id} - ${hospede.nome}`;
                    option.selected = hospedesSelecionados.includes(hospede.id);
                    select.appendChild(option);
                });
            }

            // Função para abrir modal de nova condição
            function abrirModalNovaCondicao() {
                // Limpar formulário
                document.getElementById('formNovaCondicao').reset();
                
                // Preencher select de hóspedes
                preencherSelectHospedes('novoHospedesAssociados');
                
                // Exibir modal
                document.getElementById('modalNovaCondicao').style.display = 'flex';
            }

            // Função para fechar modal de nova condição
            function fecharModalNovaCondicao() {
                document.getElementById('modalNovaCondicao').style.display = 'none';
            }

            // Função para salvar nova condição
            function salvarNovaCondicao() {
                const nome = document.getElementById('novoNome').value;
                const categoria = document.getElementById('novoCategoria').value;
                const descricao = document.getElementById('novoDescricao').value;
                
                // Obter hóspedes selecionados
                const select = document.getElementById('novoHospedesAssociados');
                const hospedesAssociados = Array.from(select.selectedOptions).map(option => option.value);
                
                // Validar campos obrigatórios
                if (!nome || !categoria) {
                    alert('Por favor, preencha todos os campos obrigatórios!');
                    return;
                }
                
                // Gerar ID único para a nova condição (formato: CS + número sequencial)
                const novoId = gerarNovoId();
                
                // Criar nova condição
                const novaCondicao = {
                    id: novoId,
                    nome,
                    categoria,
                    descricao,
                    hospedesAssociados
                };
                
                // Adicionar à lista de condições
                condicoes.push(novaCondicao);
                
                // Atualizar tabela
                renderizarTabela();
                
                // Fechar modal
                fecharModalNovaCondicao();
                
                alert(`Condição "${nome}" adicionada com sucesso!`);
            }

            // Função para gerar novo ID
            function gerarNovoId() {
                // Encontrar o maior número de ID atual
                let maxNum = 0;
                condicoes.forEach(condicao => {
                    const num = parseInt(condicao.id.replace('CS', ''));
                    if (num > maxNum) {
                        maxNum = num;
                    }
                });
                
                // Gerar próximo número e formatar com zeros à esquerda
                const nextNum = maxNum + 1;
                return `CS${nextNum.toString().padStart(3, '0')}`;
            }

            // Função para editar condição
            function editarCondicao(id) {
                const condicao = condicoes.find(c => c.id === id);
                if (!condicao) return;
                
                // Preencher formulário
                document.getElementById('editarCondicaoId').value = condicao.id;
                document.getElementById('editarNome').value = condicao.nome;
                document.getElementById('editarDescricao').value = condicao.descricao || '';
                // Exibir modal
                document.getElementById('modalEditarCondicao').style.display = 'flex';
            }

            // Função para fechar modal de edição
            function fecharModalEditarCondicao() {
                document.getElementById('modalEditarCondicao').style.display = 'none';
            }

            // Função para salvar condição editada
            function salvarCondicaoEditada() {
                const id = document.getElementById('editarCondicaoId').value;
                const nome = document.getElementById('editarNome').value;
                const categoria = document.getElementById('editarCategoria').value;
                const descricao = document.getElementById('editarDescricao').value;
                
                // Obter hóspedes selecionados
                const select = document.getElementById('editarHospedesAssociados');
                const hospedesAssociados = Array.from(select.selectedOptions).map(option => option.value);
                
                // Validar campos obrigatórios
                if (!nome || !categoria) {
                    alert('Por favor, preencha todos os campos obrigatórios!');
                    return;
                }
                
                // Atualizar condição
                const index = condicoes.findIndex(c => c.id === id);
                if (index !== -1) {
                    condicoes[index] = {
                        id,
                        nome,
                        categoria,
                        descricao,
                        hospedesAssociados
                    };
                }
                
                // Atualizar tabela
                renderizarTabela();
                
                // Fechar modal
                fecharModalEditarCondicao();
                
                alert(`Condição "${nome}" atualizada com sucesso!`);
            }

            // Função para excluir condição
            function excluirCondicao(id) {
                const condicao = condicoes.find(c => c.id === id);
                if (!condicao) return;
                
                if (confirm(`Deseja realmente excluir a condição "${condicao.nome}"?`)) {
                    condicoes = condicoes.filter(c => c.id !== id);
                    renderizarTabela();
                    alert('Condição excluída com sucesso!');
                }
            }

            // Função para abrir modal de associar hóspede
            function abrirModalAssociarHospede(id) {
                const condicao = condicoes.find(c => c.id === id);
                if (!condicao) return;
                
                // Preencher ID da condição
                document.getElementById('associarCondicaoId').value = condicao.id;
                
                // Preencher select de hóspedes (excluindo os já associados)
                const select = document.getElementById('associarHospede');
                select.innerHTML = '<option value="">Selecione um hóspede</option>';
                
                hospedes.forEach(hospede => {
                    if (!condicao.hospedesAssociados.includes(hospede.id)) {
                        const option = document.createElement('option');
                        option.value = hospede.id;
                        option.text = `${hospede.id} - ${hospede.nome}`;
                        select.appendChild(option);
                    }
                });
                
                // Verificar se há hóspedes disponíveis para associar
                if (select.options.length <= 1) {
                    alert('Todos os hóspedes já estão associados a esta condição.');
                    return;
                }
                
                // Exibir modal
                document.getElementById('modalAssociarHospede').style.display = 'flex';
            }

            // Função para fechar modal de associar hóspede
            function fecharModalAssociarHospede() {
                document.getElementById('modalAssociarHospede').style.display = 'none';
            }

            // Função para salvar associação de hóspede
            function salvarAssociacaoHospede() {
                const condicaoId = document.getElementById('associarCondicaoId').value;
                const hospedeId = document.getElementById('associarHospede').value;
                
                // Validar campos obrigatórios
                if (!hospedeId) {
                    alert('Por favor, selecione um hóspede!');
                    return;
                }
                
                // Atualizar condição
                const index = condicoes.findIndex(c => c.id === condicaoId);
                if (index !== -1) {
                    // Verificar se o hóspede já está associado
                    if (!condicoes[index].hospedesAssociados.includes(hospedeId)) {
                        condicoes[index].hospedesAssociados.push(hospedeId);
                    }
                }
                
                // Atualizar tabela
                renderizarTabela();
                
                // Fechar modal
                fecharModalAssociarHospede();
                
                const hospede = hospedes.find(h => h.id === hospedeId);
                const condicao = condicoes.find(c => c.id === condicaoId);
                
                alert(`Hóspede "${hospede.nome}" associado à condição "${condicao.nome}" com sucesso!`);
            }

            // Função para pesquisar condições
            function pesquisarCondicoes() {
                const searchTerm = document.getElementById('searchInput').value.toLowerCase();
                
                if (!searchTerm) {
                    renderizarTabela();
                    return;
                }
                
                const tbody = document.getElementById('tabelaCondicoes');
                tbody.innerHTML = '';

                const resultados = condicoes.filter(condicao => {
                    // Verificar se o termo de pesquisa está no ID, nome, categoria ou descrição
                    const basicMatch = condicao.id.toLowerCase().includes(searchTerm) ||
                        condicao.nome.toLowerCase().includes(searchTerm) ||
                        getCategoriaTexto(condicao.categoria).toLowerCase().includes(searchTerm) ||
                        (condicao.descricao && condicao.descricao.toLowerCase().includes(searchTerm));
                    
                    // Verificar se o termo de pesquisa está em algum dos hóspedes associados
                    const hospedesMatch = condicao.hospedesAssociados.some(hospedeId => {
                        const hospede = hospedes.find(h => h.id === hospedeId);
                        return hospede && hospede.nome.toLowerCase().includes(searchTerm);
                    });
                    
                    return basicMatch || hospedesMatch;
                });
                
                if (resultados.length === 0) {
                    const tr = document.createElement('tr');
                    tr.innerHTML = '<td colspan="6" style="text-align: center;">Nenhum resultado encontrado</td>';
                    tbody.appendChild(tr);
                    return;
                }
                
                resultados.forEach(condicao => {
                    const tr = document.createElement('tr');
                    
                    // Criar lista de hóspedes associados
                    let hospedesHTML = '';
                    if (condicao.hospedesAssociados.length > 0) {
                        condicao.hospedesAssociados.forEach(hospedeId => {
                            const hospede = hospedes.find(h => h.id === hospedeId);
                            if (hospede) {
                                hospedesHTML += `<span class="chip bg-cinza">${hospede.nome}</span>`;
                            }
                        });
                    } else {
                        hospedesHTML = '<span class="fonte-menor">Nenhum hóspede associado</span>';
                    }
                    
                    tr.innerHTML = `
                        <td>${condicao.id}</td>
                        <td>${condicao.nome}</td>
                        <td><span class="tag-condicao tag-${condicao.categoria}">${getCategoriaTexto(condicao.categoria)}</span></td>
                        <td>${condicao.descricao || '-'}</td>
                        <td class="condicoes-lista">${hospedesHTML}</td>
                        <td class="acoes">
                            <a href="javascript:void(0)" class="icone-salvar" onclick="editarCondicao('${condicao.id}')">✏️</a>
                            <a href="javascript:void(0)" class="icone-excluir" onclick="excluirCondicao('${condicao.id}')">🗑️</a>
                            <a href="javascript:void(0)" class="icone-adicionar" onclick="abrirModalAssociarHospede('${condicao.id}')">👤</a>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            }

            // Inicializar a página
            document.addEventListener('DOMContentLoaded', function() {
                console.log("DOM carregado, iniciando aplicação");
                
                // Renderizar tabela inicial
                renderizarTabela();
                
                // Recuperar o estado do menu do localStorage
                const menuAtivo = localStorage.getItem('menuAtivo') || 'Configuracoes';
                
                // Aplicar o estado do menu
                document.getElementById('Monitoramento').classList.remove('ativo');
                document.getElementById('Configuracoes').classList.remove('ativo');
                document.getElementById('Relatorios').classList.remove('ativo');

                document.getElementById('menuMonitoramento').classList.add('none');
                document.getElementById('menuConfiguracoes').classList.add('none');
                document.getElementById('menuRelatorios').classList.add('none');

                document.getElementById(menuAtivo).classList.add('ativo');
                document.getElementById('menu' + menuAtivo).classList.remove('none');
                
                // Adicionar eventos para fechar modais ao clicar fora
                document.querySelectorAll('.modal-overlay').forEach(modal => {
                    modal.addEventListener('click', function(e) {
                        if (e.target === this) {
                            this.style.display = 'none';
                        }
                    });
                });
                
                console.log("Inicialização concluída");
            });

            // Verificar se a página foi carregada completamente
            window.onload = function() {
                console.log("Página totalmente carregada (window.onload)");
                
                // Verificar se a tabela foi renderizada
                const tbody = document.getElementById('tabelaCondicoes');
                if (tbody && !tbody.innerHTML.trim()) {
                    console.warn("A tabela está vazia após o carregamento completo, renderizando novamente...");
                    renderizarTabela();
                }
            };
        </script>
    </body>
</html>